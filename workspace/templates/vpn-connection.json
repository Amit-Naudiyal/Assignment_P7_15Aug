{
    "AWSTemplateFormatVersion": "2010-09-09",
    "Description": "VPN Connection template tested and working for an AWS Account. Need to check for yours.",
    "Parameters": {
        "VPC": {
            "Description": "Select VPC.",
            "Type": "AWS::EC2::VPC::Id"
        },
        "VPCRouteTable": {
            "Description": "Select VPC Route Table",
            "Type": "String",
            "Default": "rtb-a479bedb"
        },
        "RemoteVpnDeviceIp": {
            "Description": "Enter External IP Address of the Customer VPN Device.",
            "Type": "String",
            "MinLength": "7",
            "MaxLength": "12",
            "Default": "18.232.9.136"
        },
        "RemoteNetworkCidr": {
            "Description": "Enter Remote Network IP Range CIDR (i.e. 192.168.100.0/24).",
            "Type": "String",
            "MinLength": "11",
            "MaxLength": "50",
            "Default": "192.168.100.0/24, 10.0.100.0/24"
        }
    },
    "Resources": {
        "VPNGateway": {
            "Type": "AWS::EC2::VPNGateway",
            "Properties": {
                "Type": "ipsec.1",
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": {
                            "Ref": "AWS::StackName"
                        }
                    }
                ]
            }
        },
        "VPNGatewayAttachment": {
            "Type": "AWS::EC2::VPCGatewayAttachment",
            "Properties": {
                "VpcId": {
                    "Ref": "VPC"
                },
                "VpnGatewayId": {
                    "Ref": "VPNGateway"
                }
            }
        },
        "CustomerGateway": {
            "Type": "AWS::EC2::CustomerGateway",
            "Properties": {
                "Type": "ipsec.1",
                "BgpAsn": "65000",
                "IpAddress": {
                    "Ref": "RemoteVpnDeviceIp"
                },
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": {
                            "Ref": "AWS::StackName"
                        }
                    }
                ]
            }
        },
        "VPNGatewayRouteProp" : {
		  "Type" : "AWS::EC2::VPNGatewayRoutePropagation",
		  "DependsOn": "VPNGatewayAttachment",
		  "Properties" : {
		    "RouteTableIds" : [{"Ref" : "VPCRouteTable"}],
		    "VpnGatewayId" : {"Ref" : "VPNGateway"}
		  }
		},
        "VPNConnection": {
            "Type": "AWS::EC2::VPNConnection",
            "DependsOn": [
                "CustomerGateway",
                "VPNGateway"
            ],
            "Properties": {
                "Type": "ipsec.1",
                "StaticRoutesOnly": "true",
                "CustomerGatewayId": {
                    "Ref": "CustomerGateway"
                },
                "VpnGatewayId": {
                    "Ref": "VPNGateway"
                },
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": {
                            "Ref": "AWS::StackName"
                        }
                    }
                ]
            }
        }
    }
}